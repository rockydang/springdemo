<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--Topic 映射关系配置文件 -->
<mapper namespace="com.mogujie.service.arkmaster.dao.topic.TopicDao">
	<sql id="basicColumn">
		id,name,marketId,img,link,isRecomItem,itemDataSource,itemInfos,status,created,updated,isDeleted,sort,editorId,editNick
	</sql>
	<sql id="basicValues">
		#{id}, #{name}, #{marketId}, #{img}, #{link}, #{isRecomItem},#{itemDataSource}, #{itemInfos}, #{status},#{created},#{updated},#{isDeleted},#{sort},#{editorId},#{editNick}
	</sql>

	<sql id="Where_Clause">
		<!-- ignore isDeleted = 1 -->
		isDeleted &lt;&gt; 1
		<if test="id != null">
			and id = #{id}
		</if>
		<if test="name != null">
			and name = #{name}
		</if>
		<if test="marketId != null">
			and marketId = #{marketId}
		</if>

		<if test="isDeleted != null">
			and isDeleted = #{isDeleted}
		</if>

		<if test="ids != null">
			AND id in
			<foreach collection="ids" item="id" open="(" close=")"
					 separator=",">
				#{id}
			</foreach>
		</if>

		<if test="permissions!=null and permissions.size()>0">
			<if test="!isFilter">
				and marketId in
				<foreach collection="permissions" item="p" open="(" close=")"
						 separator=",">
					#{p.moduleValue}
				</foreach>

			</if>

			<if test="isFilter">
				and (
				<foreach collection="permissions" item="p" open="(" close=")" separator=") or (">
					<if test="p.action=='self'">
						id='null'
					</if>
					<if test="p.action=='mng'">
						marketId=#{p.moduleValue}
					</if>
				</foreach>
				)
			</if>

			<if test="permissions==null or permissions.size()==0">
				and marketId = 'none'
			</if>

		</if>
	</sql>

	<!-- 开发负责人：延霄
	     功能说明：添加专题信息-->
	<insert id="addTopic" parameterType="topicDO" useGeneratedKeys="true" keyProperty="id">
		insert into Topic(
		<include refid="basicColumn" />
		)values(
		<include refid="basicValues" />
		)
	</insert>

	<!-- 开发负责人：延霄
	     功能说明：更新专题信息-->
	<update id="updateTopic" parameterType="topicDO" >
		update Topic
		set id = #{id}
		<if test="name != null">
			,name=#{name}
		</if>
		<if test="marketId != null">
			,marketId = #{marketId}
		</if>
		<if test="img != null">
			,img = #{img}
		</if>
		<if test="link != null">
			,link = #{link}
		</if>
		<if test="isRecomItem != null">
			,isRecomItem = #{isRecomItem}
		</if>
		<if test="itemDataSource != null">
			,itemDataSource = #{itemDataSource}
		</if>
		<if test="itemInfos != null">
			,itemInfos = #{itemInfos}
		</if>
		<if test="status != null">
		    ,status= #{status}
		</if>
		<if test="updated != null">
			,updated = #{updated}
		</if>
		<if test="isDeleted != null">
			,isDeleted= #{isDeleted}
		</if>
		<if test="sort != null">
			,sort = #{sort}
		</if>
		where
		id = #{id}
		LIMIT 1
	</update>

	<!-- 开发负责人：延霄
         功能说明：查询专题总数 -->
	<select id="queryTopicListRowCount" parameterType="topicQuery" resultType="int">
		select count(id)
		from Topic
		<where>
			<include refid="Where_Clause"/>
		</where>
		LIMIT 1
	</select>

	<!-- 开发负责人：延霄
    	 功能说明：根据条件查询专题列表 -->
	<select id="queryTopicList" parameterType="topicQuery" resultType="topicDO">
		select <include refid="basicColumn" />
		from Topic
		<where>
			<include refid="Where_Clause"/>
		</where>
		order by sort desc
		<if test="start &gt;= 0 and pageSize &gt; 0">
			limit #{start}, #{pageSize}
		</if>
	</select>

	<!-- 开发负责人：延霄
    	 功能说明：根据主键查询专题信息 -->
	<select id="queryTopicById" parameterType="java.lang.Long" resultType="topicDO">
		select <include refid="basicColumn" />
		from  Topic
		where id = #{id}
		LIMIT 1
	</select>
</mapper>